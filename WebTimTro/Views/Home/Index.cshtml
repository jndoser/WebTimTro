@*@model IEnumerable<WebTimTro.Models.PhongTroVM>
@inject WebTimTro.Interfaces.IUnitOfWork _unitOfWork

*@
@{
    ViewData["Title"] = "Home Page";
    //List<PhongTroVM> phongTros = Model.ToList();
    //List<string> firstHinhAnhs = ViewBag.FirstHinhAnhs;
    //List<string> someDichVu = ViewBag.SomeDichVu;
}

<div class="row mb-5 load-list" style="margin-left:10px;">
   @* @for (int i = 0; i < phongTros.Count; i++)
    {
        <div class="col-md-6 col-lg-4">
            <h6 class="mt-2 text-muted"></h6>
            <div class="card">
                <img class="card-img-top" src="/images/@firstHinhAnhs[i]" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title">@phongTros[i].Ten</h5>
                    <p class="card-text">@phongTros[i].SucChua người ở</p>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">@someDichVu[i]</li>
                    <li class="list-group-item">Giá: @phongTros[i].Gia VND</li>
                </ul>
                <div class="card-body">
                    <a id="isQuanTamPhongTro@(phongTros[i].Id)" style="cursor:pointer;" onclick="QuanTam(@phongTros[i].Id)" class="card-link">
                        @(_unitOfWork.PhongTroQuanTam.IsQuanTam(_unitOfWork.NguoiDung.GetUserId(),
                    phongTros[i].Id) ? "Đã quan tâm" : "Quan tâm")
                    </a>
                    <a href="/Home/Detail/@phongTros[i].Id" class="card-link">Xem phòng trọ</a>
                    <a id="isSavedPhongTro@(phongTros[i].Id)" style="cursor:pointer;" onclick="Save(@phongTros[i].Id)"
                   class="card-link">
                        @(_unitOfWork.PhongTroLuuTru.IsSaved(_unitOfWork.NguoiDung.GetUserId(),
                    phongTros[i].Id) ? "Đã Lưu" : "Lưu")
                    </a>
                </div>
            </div>
        </div>
    }*@
</div>
<div class="demo-inline-spacing" style="margin-left:5px;">
    <!-- Basic Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination" id="load-pagination">
            @*<li class="page-item first">
            <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevrons-left"></i></a>
            </li>
            <li class="page-item prev">
            <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-left"></i></a>
            </li>
            <li class="page-item">
            <a class="page-link" href="javascript:void(0);">1</a>
            </li>
            <li class="page-item active">
            <a class="page-link" href="javascript:void(0);">3</a>
            </li>
            <li class="page-item">
            <a class="page-link" href="javascript:void(0);">4</a>
            </li>
            <li class="page-item">
            <a class="page-link" href="javascript:void(0);">5</a>
            </li>
            <li class="page-item next">
            <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-right"></i></a>
            </li>
            <li class="page-item last">
            <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevrons-right"></i></a>
            </li>*@
        </ul>
    </nav>
    <!--/ Basic Pagination -->
</div>
<script>
    $(function() {
        // function load pagination
        var load = function(txtSearch, page) {
            $.ajax({
                url: '/Home/GetAllPost',
                type: 'get',
                data: { txtSearch: txtSearch, page: page },
                success: function(result) {
                    console.log(result);
                    var str = "";
                    $.each(result.data, function(index, value) {
                        str += '<div class="col-md-6 col-lg-4">';
                        str += '<h6 class="mt-2 text-muted"></h6>';
                        str += '<div class="card">';
                        str += '<img class="card-img-top" src="images/' + result.firstHinhAnhs[index] + '" alt="Card image cap">'; 
                        str += '<div class="card-body">';
                        str += '<h5 class="card-title">' + value.ten + '</h5>';
                        str += '<p class="card-text">' + value.sucChua + ' người ở</p>'; 
                        str += '</div>'; 
                        str += '<ul class="list-group list-group-flush">'; 
                        str += '<li class="list-group-item">' + result.someDichVu[index] + '</li>'; 
                        str += '<li class="list-group-item">Giá: ' + value.gia + ' VND </li>'; 
                        str += '</ul>'; 
                        str += '<div class="card-body">';
                        str += '<a id="isQuanTamPhongTro' + value.id + '" style="cursor:pointer;" onclick="QuanTam(' + value.id + ')" class="card-link">';
                        str += '' + result.favStatusList[index] + '</a>'; 
                        str += '<a href="/Home/Detail/' + value.id + '" class="card-link">Xem phòng trọ</a>'; 
                        str += '<a id="isSavedPhongTro' + value.id + '" style="cursor:pointer;" onclick="Save(' + value.id + ')" class="card-link">';
                        str += '' + result.savedStatusList[index] + '</a>';
                        str += '</div>'; 
                        str += '</div>';
                        str += '</div>'; 

                        // Create pagination
                        var pagination_string = "";
                        var pageCurrent = result.pageCurrent;
                        var numSize = result.numSize;

                        // Create button previous
                        if (pageCurrent > 1) {
                            var pagePrevious = pageCurrent - 1;
                            pagination_string += '<li class="page-item">';
                            pagination_string += '<a class="page-link" href="" data-page="' + pagePrevious + '">Previous</a>';
                            pagination_string += '</li>';
                        }

                        for (var i = 1; i <= numSize; i++) {
                            if (i == pageCurrent) {
                                pagination_string += '<li class="page-item active">';
                                pagination_string += '<a class="page-link" href="" data-page="' + i + '">' + pageCurrent + '</a>';
                                pagination_string += '</li>';
                            } else {
                                pagination_string += '<li class="page-item">';
                                pagination_string += '<a class="page-link" href="" data-page="' + i + '">' + i + '</a>';
                                pagination_string += '</li>';
                            }
                        }

                        // Create button next
                        if (pageCurrent > 0 && pageCurrent < numSize) {
                            var pageNext = pageCurrent + 1;
                            pagination_string += '<li class="page-item">';
                            pagination_string += '<a class="page-link" href="" data-page="' + pageNext + '">Next</a>';
                            pagination_string += '</li>';
                        }

                        // Load pagination
                        $("#load-pagination").html(pagination_string);
                    });

                    // Load str to class="load-list"
                    $(".load-list").html(str);
                }
            });
        }



        // Click event pagination
        $("body").on("click", ".pagination li a", function(event) {
            event.preventDefault();
            var page = $(this).attr('data-page');

            // Load event pagination
            var txtSearch = $('.txtSearch').val();
            if (txtSearch != "") {
                load(txtSearch, page);
            } else {
                load(null, page);
            }
        });

        // Click event search
        //$('#search').click(function() {
        //    var txtSearch = $('.txtSearch').val();
        //    if(txtSearch != ''){
        //        load(txtSearch, 1);
        //    } else {
        //        load(null, 1);
        //        }
        //    });
        //});

        // Load init
        load(null, 1);
    });


    function Save(id) {
        var isSaved = $('#isSavedPhongTro' + id).html();
        console.log(isSaved);
        if (isSaved.trim() == "Lưu") {
            $.ajax({
                url: '/Home/SavePhongTro',
                method: 'post',
                data: { id: id },
                success: function(result) {
                    if (result.status == "ok") {
                        $('#isSavedPhongTro' + id).html('Đã lưu');
                    }
                },
                error: function(err) {
                    console.log(err);
                }
            });
        } else {
            $.ajax({
                url: '/Home/UnSavePhongTro',
                method: 'post',
                data: { id: id },
                success: function(result) {
                    if (result.status == "ok") {
                        $('#isSavedPhongTro' + id).html('Lưu');
                    }
                },
                error: function(err) {
                    console.log(err);
                }
            });
        }
    }

    function QuanTam(id) {
        var isSaved = $('#isQuanTamPhongTro' + id).html();
        console.log(isSaved);
        if (isSaved.trim() == "Quan tâm") {
            console.log('Đang quan tâm phòng trọ ' + id);
            $.ajax({
                url: '/Home/QuanTamPhongTro',
                method: 'post',
                data: { id: id },
                success: function(result) {
                    if (result.status == "ok") {
                        console.log('Đã quan tâm phòng trọ ' + id);
                        $('#isQuanTamPhongTro' + id).html('Đã quan tâm');
                    }
                },
                error: function(err) {
                    console.log(err);
                }
            });
        } else {
            console.log('Đang bỏ quan tâm phòng trọ ' + id);
            $.ajax({
                url: '/Home/BoQuanTamPhongTro',
                method: 'post',
                data: { id: id },
                success: function(result) {
                    if (result.status == "ok") {
                        console.log('Đã bỏ quan tâm phòng trọ ' + id);
                        $('#isQuanTamPhongTro' + id).html('Quan tâm');
                    }
                },
                error: function(err) {
                    console.log(err);
                }
            });
        }
    }
</script>